<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Book Apartment</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" rel="stylesheet" />
</head>
<body class="bg-gray-100 text-gray-800 p-6">

  <div class="max-w-3xl mx-auto bg-white rounded-lg shadow-md p-6">
    <h1 class="text-2xl font-bold mb-4">Book Your Stay</h1>

    <div class="mb-4">
      <p><strong>Name:</strong> <span id="userName">Loading...</span></p>
      <p><strong>Email:</strong> <span id="userEmail">Loading...</span></p>
    </div>

    <div class="mb-4">
      <label class="block font-medium mb-1">Select Dates (Check-in & Check-out):</label>
      <input type="text" id="datepicker" class="w-full px-4 py-2 border rounded" placeholder="Select date range" />
    </div>

    <div class="mb-4">
      <p><strong>Apartment:</strong> <span id="apartmentName">Modern Studio in Kilimani</span></p>
      <p><strong>Rate:</strong> $40 / night</p>
    </div>

    <div id="totalCost" class="font-semibold mb-4 hidden"></div>

    <button id="bookBtn" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">Book Now</button>
  </div>

  <!-- Modal -->
  <div id="bookingModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center">
    <div class="bg-white rounded-lg p-6 text-center shadow-lg w-full max-w-md">
      <h2 class="text-xl font-bold mb-2">Confirm Your Booking</h2>
      <p id="modalAmount" class="mb-4 text-gray-700"></p>
      <button id="confirmBookBtn" class="bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700">Confirm Booking</button>
      <button id="closeModalBtn" class="mt-2 text-gray-500 hover:text-gray-800 block w-full">Cancel</button>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script>
    // Fetch user name and email from localStorage
    document.getElementById("userName").textContent = localStorage.getItem("fullName") || "Not found";
    document.getElementById("userEmail").textContent = localStorage.getItem("email") || "Not found";

    flatpickr("#datepicker", {
      mode: "range",
      dateFormat: "Y-m-d",
    });

    const nightlyRate = 40;
    const datepicker = document.getElementById("datepicker");
    const totalCostDiv = document.getElementById("totalCost");
    const bookBtn = document.getElementById("bookBtn");
    const bookingModal = document.getElementById("bookingModal");
    const modalAmount = document.getElementById("modalAmount");
    const confirmBookBtn = document.getElementById("confirmBookBtn");
    const closeModalBtn = document.getElementById("closeModalBtn");
    const apartmentName = document.getElementById("apartmentName").textContent;

    let checkIn = "";
    let checkOut = "";
    let nights = 0;
    let totalCost = 0;

    bookBtn.addEventListener("click", () => {
      const dates = datepicker.value.split(" to ");
      if (dates.length === 2) {
        checkIn = dates[0];
        checkOut = dates[1];
        const start = new Date(checkIn);
        const end = new Date(checkOut);

        nights = Math.ceil((end - start) / (1000 * 60 * 60 * 24));
        if (nights < 1) {
          alert("Check-out must be at least 1 day after check-in.");
          return;
        }

        totalCost = nights * nightlyRate;
        totalCostDiv.textContent = `Total: $${totalCost} for ${nights} night${nights > 1 ? "s" : ""}`;
        totalCostDiv.classList.remove("hidden");

        modalAmount.textContent = `Total: $${totalCost} for ${nights} night${nights > 1 ? "s" : ""}`;
        bookingModal.classList.remove("hidden");
        bookingModal.classList.add("flex");
      } else {
        alert("Please select a valid check-in and check-out date.");
      }
    });

    closeModalBtn.addEventListener("click", () => {
      bookingModal.classList.add("hidden");
      bookingModal.classList.remove("flex");
    });

    confirmBookBtn.addEventListener("click", () => {
      const params = new URLSearchParams({
        amount: totalCost,
        checkin: checkIn,
        checkout: checkOut,
        apartment: apartmentName,
        name: localStorage.getItem("fullName") || "",
        email: localStorage.getItem("email") || "",
      });
      window.location.href = "payment.html?" + params.toString();
    });
  </script>
</body>
</html>
