<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Book Listing - Nova Stays KE</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <style>
    .display-box {
      background-color: #f9fafb;
      border: 1px solid #d1d5db;
      padding: 0.6rem;
      border-radius: 0.375rem;
      font-size: 0.95rem;
    }
  </style>
</head>
<body class="bg-gray-50 text-gray-800">

  <!-- Header -->
  <header class="bg-white shadow p-4 mb-6">
    <h1 class="text-xl font-bold text-green-600">Nova Stays KE</h1>
  </header>

  <!-- Booking Information Display -->
  <div class="max-w-3xl mx-auto bg-white shadow-md rounded-lg p-6">
    <h2 class="text-lg font-semibold mb-4">Confirm Your Booking</h2>

    <!-- Display Section -->
    <div class="grid md:grid-cols-2 gap-4 mb-4">
      <div>
        <label class="block text-sm font-medium text-gray-700">Guest Name</label>
        <div id="guestName" class="display-box"></div>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Email</label>
        <div id="guestEmail" class="display-box"></div>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Mobile Number</label>
        <div id="guestPhone" class="display-box"></div>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Listing Name</label>
        <div id="listingName" class="display-box"></div>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Location</label>
        <div id="listingLocation" class="display-box"></div>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Price Per Night (USD)</label>
        <div id="pricePerNight" class="display-box"></div>
      </div>
    </div>

    <!-- Calendar & Time -->
    <div class="grid md:grid-cols-2 gap-4 mt-4">
      <div>
        <label class="block text-sm font-medium text-gray-700">Check-In Date</label>
        <input id="checkinDate" class="w-full p-2 border rounded-md" type="text" placeholder="Select check-in date" />
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Check-In Time</label>
        <input id="checkinTime" class="w-full p-2 border rounded-md" type="time" />
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Check-Out Date</label>
        <input id="checkoutDate" class="w-full p-2 border rounded-md" type="text" placeholder="Select check-out date" />
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Check-Out Time</label>
        <input id="checkoutTime" class="w-full p-2 border rounded-md" type="time" />
      </div>
    </div>

    <!-- Guest & Calculation -->
    <div class="grid md:grid-cols-2 gap-4 mt-6">
      <div>
        <label class="block text-sm font-medium text-gray-700">Guests (optional)</label>
        <select id="guestCount" class="w-full p-2 border rounded-md">
          <option value="1">1 Guest</option>
          <option value="2">2 Guests</option>
        </select>
      </div>
      <div>
        <label class="block text-sm font-medium text-gray-700">Total Nights</label>
        <div id="nights" class="display-box">0</div>
      </div>
    </div>

    <div class="mt-4">
      <label class="block text-sm font-medium text-gray-700">Total Amount (USD)</label>
      <div id="totalAmount" class="display-box font-bold text-green-700">0.00</div>
    </div>

    <button class="mt-6 w-full bg-green-600 hover:bg-green-700 text-white py-2 rounded-md text-sm font-semibold">
      Confirm & Book Now
    </button>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script>
    // Extract data from URL
    const urlParams = new URLSearchParams(window.location.search);
    const listing = urlParams.get("listing") || "N/A";
    const price = parseFloat(urlParams.get("price")) || 0;
    const location = urlParams.get("location") || "Nairobi";
    const user = urlParams.get("user") || "Guest";
    const email = urlParams.get("email") || "guest@example.com";
    const phone = "0700123456"; // Replace with dynamic if needed

    // Populate Display Boxes
    document.getElementById("guestName").textContent = user;
    document.getElementById("guestEmail").textContent = email;
    document.getElementById("guestPhone").textContent = phone;
    document.getElementById("listingName").textContent = listing;
    document.getElementById("listingLocation").textContent = location;
    document.getElementById("pricePerNight").textContent = price.toFixed(2);

    // Flatpickr Setup
    const checkin = document.getElementById("checkinDate");
    const checkout = document.getElementById("checkoutDate");

    let checkinDateVal, checkoutDateVal;

    flatpickr(checkin, {
      dateFormat: "Y-m-d",
      onChange: function(selectedDates) {
        checkinDateVal = selectedDates[0];
        calculateTotal();
      }
    });

    flatpickr(checkout, {
      dateFormat: "Y-m-d",
      onChange: function(selectedDates) {
        const selected = selectedDates[0];
        const limit = new Date(selected);
        limit.setHours(13); // 1300Hrs

        if (selected > limit) {
          alert("Check-out time must not exceed 1300Hrs (1 PM Africa Time)");
          checkout.value = "";
          return;
        }

        checkoutDateVal = selected;
        calculateTotal();
      }
    });

    function calculateTotal() {
      const nightsDisplay = document.getElementById("nights");
      const totalDisplay = document.getElementById("totalAmount");

      if (checkinDateVal && checkoutDateVal && checkoutDateVal > checkinDateVal) {
        const diffTime = checkoutDateVal - checkinDateVal;
        const numNights = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

        nightsDisplay.textContent = numNights;

        const guestCount = parseInt(document.getElementById("guestCount").value) || 1;
        const totalPrice = price * numNights * 1; // guests optional, not multiplying

        totalDisplay.textContent = totalPrice.toFixed(2);
      }
    }

    document.getElementById("guestCount").addEventListener("change", calculateTotal);
  </script>
</body>
</html>
