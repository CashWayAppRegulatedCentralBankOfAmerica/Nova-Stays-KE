<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Nova Stays KE - Book Apartment</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Modal background */
    .modal-bg {
      background-color: rgba(0,0,0,0.5);
      position: fixed;
      inset: 0;
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1050;
    }
    .modal-bg.active {
      display: flex;
    }
  </style>
</head>
<body class="bg-gray-50 text-gray-800">

  <header class="bg-white shadow p-4 flex justify-between items-center">
    <h1 class="text-xl font-bold text-green-600">Nova Stays KE - Booking</h1>
  </header>

  <main class="max-w-xl mx-auto mt-8 p-6 bg-white rounded-md shadow-md">
    <div id="bookingSummary" class="mb-4 text-sm text-gray-700"></div>

    <form id="bookingForm" class="space-y-4">
      <div>
        <label for="name" class="block mb-1 font-medium">Full Name</label>
        <input type="text" id="name" name="name" required readonly class="w-full border border-gray-300 rounded px-3 py-2 bg-gray-100" />
      </div>

      <div>
        <label for="email" class="block mb-1 font-medium">Email Address</label>
        <input type="email" id="email" name="email" required readonly class="w-full border border-gray-300 rounded px-3 py-2 bg-gray-100" />
      </div>

      <div>
        <label for="checkin" class="block mb-1 font-medium">Check-in Date</label>
        <input type="date" id="checkin" name="checkin" required class="w-full border border-gray-300 rounded px-3 py-2" />
      </div>

      <div>
        <label for="checkout" class="block mb-1 font-medium">Check-out Date</label>
        <input type="date" id="checkout" name="checkout" required class="w-full border border-gray-300 rounded px-3 py-2" />
      </div>

      <div>
        <label for="guests" class="block mb-1 font-medium">Guests</label>
        <input type="number" id="guests" name="guests" min="1" value="1" required class="w-full border border-gray-300 rounded px-3 py-2" />
      </div>

      <!-- Total Price Display -->
      <div>
        <label class="block mb-1 font-medium">Total Price</label>
        <p id="totalPrice" class="text-green-600 font-bold text-lg">USD 0</p>
      </div>

      <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white py-2 rounded-md font-semibold">Confirm Booking</button>
    </form>

    <div id="confirmationMessage" class="hidden mt-4 p-4 bg-green-100 border border-green-400 text-green-700 rounded">
      <h2 class="text-lg font-semibold mb-2">Booking Confirmed!</h2>
      <p id="thankYouText">Thank you for booking with Nova Stays KE. We will contact you shortly via email.</p>
      <button id="backToListingsBtn" class="mt-4 bg-green-600 hover:bg-green-700 text-white py-1.5 px-4 rounded-md">Back to Listings</button>
    </div>
  </main>

  <!-- Payment Method Selection Modal -->
  <div id="paymentMethodModal" class="modal-bg" role="dialog" aria-modal="true" aria-labelledby="paymentMethodTitle">
    <div class="bg-white rounded p-6 w-11/12 max-w-md shadow-lg">
      <h2 id="paymentMethodTitle" class="text-xl font-bold mb-4">Select Payment Method</h2>
      <div class="space-y-3">
        <button class="w-full py-2 border rounded flex items-center justify-center gap-3 hover:bg-green-50" data-method="stripe">
          <img src="https://cdn-icons-png.flaticon.com/512/179/179409.png" alt="Stripe" class="w-6 h-6" /> Stripe
        </button>
        <button class="w-full py-2 border rounded flex items-center justify-center gap-3 hover:bg-green-50" data-method="paypal">
          <img src="https://upload.wikimedia.org/wikipedia/commons/b/b5/PayPal.svg" alt="PayPal" class="w-8 h-6" /> PayPal
        </button>
        <button class="w-full py-2 border rounded flex items-center justify-center gap-3 hover:bg-green-50" data-method="mpesa">
          <img src="https://upload.wikimedia.org/wikipedia/commons/6/6b/M-Pesa_logo.svg" alt="M-Pesa" class="w-8 h-6" /> M-Pesa
        </button>
        <button class="w-full py-2 border rounded flex items-center justify-center gap-3 hover:bg-green-50" data-method="airtel">
          <img src="https://upload.wikimedia.org/wikipedia/commons/f/fb/Airtel_Logo.svg" alt="Airtel Money" class="w-8 h-6" /> Airtel Money
        </button>
      </div>
      <button id="closePaymentMethodModal" class="mt-4 text-red-600 hover:underline">Cancel</button>
    </div>
  </div>

  <!-- Stripe Card Details Modal -->
  <div id="stripeModal" class="modal-bg" role="dialog" aria-modal="true" aria-labelledby="stripeModalTitle">
    <div class="bg-white rounded p-6 w-11/12 max-w-md shadow-lg">
      <h2 id="stripeModalTitle" class="text-xl font-bold mb-4">Enter Card Details</h2>
      <form id="stripeForm" class="space-y-4" autocomplete="off">
        <div>
          <label for="cardNumber" class="block mb-1 font-medium">Card Number</label>
          <input type="text" id="cardNumber" name="cardNumber" maxlength="19" placeholder="1234 5678 9012 3456" required class="w-full border border-gray-300 rounded px-3 py-2" />
        </div>
        <div>
          <label for="expiry" class="block mb-1 font-medium">Expiry Date (MM/YY)</label>
          <input type="text" id="expiry" name="expiry" maxlength="5" placeholder="MM/YY" required class="w-full border border-gray-300 rounded px-3 py-2" />
        </div>
        <div>
          <label for="cvc" class="block mb-1 font-medium">CVC</label>
          <input type="text" id="cvc" name="cvc" maxlength="4" placeholder="123" required class="w-full border border-gray-300 rounded px-3 py-2" />
        </div>
        <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white py-2 rounded-md font-semibold">Pay</button>
      </form>
      <button id="closeStripeModal" class="mt-3 text-red-600 hover:underline">Cancel</button>
    </div>
  </div>

  <!-- Payment Code Input Modal (for Stripe, PayPal, Mpesa, Airtel) -->
  <div id="codeInputModal" class="modal-bg" role="dialog" aria-modal="true" aria-labelledby="codeInputTitle">
    <div class="bg-white rounded p-6 w-11/12 max-w-md shadow-lg">
      <h2 id="codeInputTitle" class="text-xl font-bold mb-4">Enter Payment Code</h2>
      <p class="mb-3">Please enter the code sent to your email to confirm your payment.</p>
      <form id="codeForm" class="space-y-4" autocomplete="off">
        <input type="text" id="paymentCode" name="paymentCode" maxlength="10" placeholder="Enter code" required class="w-full border border-gray-300 rounded px-3 py-2" />
        <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white py-2 rounded-md font-semibold">Confirm</button>
      </form>
      <button id="closeCodeModal" class="mt-3 text-red-600 hover:underline">Cancel</button>
    </div>
  </div>

  <!-- Mpesa Payment Instruction Modal -->
  <div id="mpesaInstructionModal" class="modal-bg" role="dialog" aria-modal="true" aria-labelledby="mpesaInstructionTitle">
    <div class="bg-white rounded p-6 w-11/12 max-w-md shadow-lg text-center">
      <h2 id="mpesaInstructionTitle" class="text-xl font-bold mb-4">M-Pesa Payment</h2>
      <p class="mb-4">Please pay via M-Pesa to till number <strong>0000</strong>.</p>
      <button id="mpesaPaidBtn" class="w-full bg-green-600 hover:bg-green-700 text-white py-2 rounded-md font-semibold mb-3">I Have Paid</button>
      <button id="closeMpesaInstructionModal" class="text-red-600 hover:underline">Cancel</button>
    </div>
  </div>

  <!-- Mpesa Transaction ID Modal -->
  <div id="mpesaTransactionModal" class="modal-bg" role="dialog" aria-modal="true" aria-labelledby="mpesaTransactionTitle">
    <div class="bg-white rounded p-6 w-11/12 max-w-md shadow-lg">
      <h2 id="mpesaTransactionTitle" class="text-xl font-bold mb-4">Enter M-Pesa Transaction ID</h2>
      <form id="mpesaTransactionForm" class="space-y-4" autocomplete="off">
        <input type="text" id="mpesaTransactionId" name="mpesaTransactionId" maxlength="20" placeholder="Transaction ID" required class="w-full border border-gray-300 rounded px-3 py-2" />
        <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white py-2 rounded-md font-semibold">Confirm</button>
      </form>
      <button id="closeMpesaTransactionModal" class="mt-3 text-red-600 hover:underline">Cancel</button>
    </div>
  </div>

  <!-- Airtel Payment Instruction Modal -->
  <div id="airtelInstructionModal" class="modal-bg" role="dialog" aria-modal="true" aria-labelledby="airtelInstructionTitle">
    <div class="bg-white rounded p-6 w-11/12 max-w-md shadow-lg text-center">
      <h2 id="airtelInstructionTitle" class="text-xl font-bold mb-4">Airtel Money Payment</h2>
      <p class="mb-4">Please pay via Airtel Money to till number <strong>0000</strong>.</p>
      <button id="airtelPaidBtn" class="w-full bg-green-600 hover:bg-green-700 text-white py-2 rounded-md font-semibold mb-3">I Have Paid</button>
      <button id="closeAirtelInstructionModal" class="text-red-600 hover:underline">Cancel</button>
    </div>
  </div>

  <!-- Airtel Transaction ID Modal -->
  <div id="airtelTransactionModal" class="modal-bg" role="dialog" aria-modal="true" aria-labelledby="airtelTransactionTitle">
    <div class="bg-white rounded p-6 w-11/12 max-w-md shadow-lg">
      <h2 id="airtelTransactionTitle" class="text-xl font-bold mb-4">Enter Airtel Transaction ID</h2>
      <form id="airtelTransactionForm" class="space-y-4" autocomplete="off">
        <input type="text" id="airtelTransactionId" name="airtelTransactionId" maxlength="20" placeholder="Transaction ID" required class="w-full border border-gray-300 rounded px-3 py-2" />
        <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white py-2 rounded-md font-semibold">Confirm</button>
      </form>
      <button id="closeAirtelTransactionModal" class="mt-3 text-red-600 hover:underline">Cancel</button>
    </div>
  </div>

  <!-- Error Modal for wrong codes -->
  <div id="errorModal" class="modal-bg" role="dialog" aria-modal="true" aria-labelledby="errorModalTitle">
    <div class="bg-white rounded p-6 w-11/12 max-w-sm shadow-lg">
      <h2 id="errorModalTitle" class="text-xl font-bold mb-4 text-red-600">Error</h2>
      <p id="errorModalMessage" class="mb-4"></p>
      <button id="closeErrorModal" class="w-full bg-red-600 hover:bg-red-700 text-white py-2 rounded-md font-semibold">Close</button>
    </div>
  </div>

  <script>
    // Hardcoded booking info & total price (simulate passed data)
    const bookingData = {
      fullName: "Jacob Amaitsa",
      email: "jacob.amaitsa@example.com",
      apartmentName: "Opal Stays Kilimani",
      totalPrice: 180,  // USD 180 for example
    };

    // DOM Elements
    const bookingForm = document.getElementById("bookingForm");
    const nameInput = document.getElementById("name");
    const emailInput = document.getElementById("email");
    const totalPriceDisplay = document.getElementById("totalPrice");
    const bookingSummary = document.getElementById("bookingSummary");
    const confirmationMessage = document.getElementById("confirmationMessage");
    const thankYouText = document.getElementById("thankYouText");
    const backToListingsBtn = document.getElementById("backToListingsBtn");

    // Modals
    const paymentMethodModal = document.getElementById("paymentMethodModal");
    const stripeModal = document.getElementById("stripeModal");
    const codeInputModal = document.getElementById("codeInputModal");
    const mpesaInstructionModal = document.getElementById("mpesaInstructionModal");
    const mpesaTransactionModal = document.getElementById("mpesaTransactionModal");
    const airtelInstructionModal = document.getElementById("airtelInstructionModal");
    const airtelTransactionModal = document.getElementById("airtelTransactionModal");
    const errorModal = document.getElementById("errorModal");

    // Close buttons
    const closePaymentMethodModalBtn = document.getElementById("closePaymentMethodModal");
    const closeStripeModalBtn = document.getElementById("closeStripeModal");
    const closeCodeModalBtn = document.getElementById("closeCodeModal");
    const closeMpesaInstructionModalBtn = document.getElementById("closeMpesaInstructionModal");
    const closeMpesaTransactionModalBtn = document.getElementById("closeMpesaTransactionModal");
    const closeAirtelInstructionModalBtn = document.getElementById("closeAirtelInstructionModal");
    const closeAirtelTransactionModalBtn = document.getElementById("closeAirtelTransactionModal");
    const closeErrorModalBtn = document.getElementById("closeErrorModal");

    // Other buttons
    const mpesaPaidBtn = document.getElementById("mpesaPaidBtn");
    const airtelPaidBtn = document.getElementById("airtelPaidBtn");
    const backToListingsButton = document.getElementById("backToListingsBtn");

    // Forms
    const stripeForm = document.getElementById("stripeForm");
    const codeForm = document.getElementById("codeForm");
    const mpesaTransactionForm = document.getElementById("mpesaTransactionForm");
    const airtelTransactionForm = document.getElementById("airtelTransactionForm");

    // Error modal message paragraph
    const errorModalMessage = document.getElementById("errorModalMessage");

    // Payment method chosen
    let selectedPaymentMethod = null;

    // Populate form with booking data on page load
    window.addEventListener("DOMContentLoaded", () => {
      nameInput.value = bookingData.fullName;
      emailInput.value = bookingData.email;
      totalPriceDisplay.textContent = `USD ${bookingData.totalPrice}`;
    });

    // Show modal function
    function showModal(modal) {
      modal.classList.add("active");
    }

    // Hide modal function
    function hideModal(modal) {
      modal.classList.remove("active");
    }

    // Show error modal with message
    function showError(message) {
      errorModalMessage.textContent = message;
      showModal(errorModal);
    }

    // On Confirm Booking submit: validate date logic, then show payment method modal
    bookingForm.addEventListener("submit", (e) => {
      e.preventDefault();

      // Validate check-in and check-out dates
      const checkin = new Date(bookingForm.checkin.value);
      const checkout = new Date(bookingForm.checkout.value);
      if (checkout <= checkin) {
        showError("Check-out date must be after Check-in date.");
        return;
      }

      // Show payment method modal
      showModal(paymentMethodModal);
    });

    // Payment Method selection buttons
    paymentMethodModal.querySelectorAll("button[data-method]").forEach(button => {
      button.addEventListener("click", () => {
        selectedPaymentMethod = button.getAttribute("data-method");
        hideModal(paymentMethodModal);

        if(selectedPaymentMethod === "stripe") {
          // Show Stripe card details modal
          showModal(stripeModal);
        }
        else if(selectedPaymentMethod === "paypal") {
          // For demo redirect directly to PayPal URL
          // After payment, user should input code (simulate here with code modal)
          window.open("https://www.paypal.com/signin", "_blank");
          setTimeout(() => {
            showModal(codeInputModal);
          }, 500);
        }
        else if(selectedPaymentMethod === "mpesa") {
          showModal(mpesaInstructionModal);
        }
        else if(selectedPaymentMethod === "airtel") {
          showModal(airtelInstructionModal);
        }
      });
    });

    // Close modals handlers
    closePaymentMethodModalBtn.addEventListener("click", () => hideModal(paymentMethodModal));
    closeStripeModalBtn.addEventListener("click", () => hideModal(stripeModal));
    closeCodeModalBtn.addEventListener("click", () => hideModal(codeInputModal));
    closeMpesaInstructionModalBtn.addEventListener("click", () => hideModal(mpesaInstructionModal));
    closeMpesaTransactionModalBtn.addEventListener("click", () => hideModal(mpesaTransactionModal));
    closeAirtelInstructionModalBtn.addEventListener("click", () => hideModal(airtelInstructionModal));
    closeAirtelTransactionModalBtn.addEventListener("click", () => hideModal(airtelTransactionModal));
    closeErrorModalBtn.addEventListener("click", () => hideModal(errorModal));

    // Stripe form payment simulation
    stripeForm.addEventListener("submit", (e) => {
      e.preventDefault();

      // Simple validation (card number length >= 13 digits, expiry and cvc presence)
      const cardNumber = stripeForm.cardNumber.value.replace(/\s+/g, '');
      const expiry = stripeForm.expiry.value;
      const cvc = stripeForm.cvc.value;

      if (cardNumber.length < 13 || !expiry || !cvc) {
        showError("Please enter valid card details.");
        return;
      }

      // Close Stripe modal and open code input modal
      hideModal(stripeModal);
      showModal(codeInputModal);
    });

    // Code form submit (Stripe & PayPal codes)
    codeForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const code = codeForm.paymentCode.value.trim();

      if(code !== "1234") {
        showError("Incorrect payment code. Please try again.");
        return;
      }

      hideModal(codeInputModal);
      showThankYou();
    });

    // Mpesa instruction modal "I Have Paid" btn
    mpesaPaidBtn.addEventListener("click", () => {
      hideModal(mpesaInstructionModal);
      showModal(mpesaTransactionModal);
    });

    // Mpesa transaction ID form
    mpesaTransactionForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const mpesaId = mpesaTransactionForm.mpesaTransactionId.value.trim();

      if(mpesaId.length < 5) {
        showError("Please enter a valid M-PESA transaction ID.");
        return;
      }

      // Simulate server validation
      // For demo, any 5+ char string is accepted
      hideModal(mpesaTransactionModal);
      showThankYou();
    });

    // Airtel instruction modal "I Have Paid" btn
    airtelPaidBtn.addEventListener("click", () => {
      hideModal(airtelInstructionModal);
      showModal(airtelTransactionModal);
    });

    // Airtel transaction ID form
    airtelTransactionForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const airtelId = airtelTransactionForm.airtelTransactionId.value.trim();

      if(airtelId.length < 5) {
        showError("Please enter a valid Airtel transaction ID.");
        return;
      }

      // Simulate server validation
      hideModal(airtelTransactionModal);
      showThankYou();
    });

    // Show thank you and confirmation message
    function showThankYou() {
      bookingSummary.classList.add("hidden");
      confirmationMessage.classList.remove("hidden");
    }

    // Back to listings button
    backToListingsBtn.addEventListener("click", () => {
      // Redirect to listings page (replace with actual URL)
      window.location.href = "index.html";
    });
  </script>
</body>
</html>
