<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Book Apartment</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: Helvetica, sans-serif;
    }
  </style>
</head>
<body class="bg-gray-100 text-gray-800">

  <div class="max-w-xl mx-auto mt-10 bg-white p-8 rounded-lg shadow-md border border-green-500">
    <h1 class="text-2xl font-bold text-green-700 mb-4">Confirm Your Booking</h1>

    <div class="mb-4">
      <p><strong>Apartment:</strong> <span id="apartmentName">Loading...</span></p>
      <p><strong>Rate:</strong> $<span id="apartmentRate">0</span> / night</p>
    </div>

    <div class="mb-4">
      <label class="block mb-1 font-medium">Check-in Date</label>
      <input type="date" id="checkin" class="w-full border border-gray-300 rounded px-3 py-2" />
    </div>

    <div class="mb-4">
      <label class="block mb-1 font-medium">Check-out Date</label>
      <input type="date" id="checkout" class="w-full border border-gray-300 rounded px-3 py-2" />
    </div>

    <div class="mb-4">
      <p><strong>Your Name:</strong> <span id="userName">Loading...</span></p>
      <p><strong>Your Email:</strong> <span id="userEmail">Loading...</span></p>
    </div>

    <div class="mb-4">
      <p><strong>Total Nights:</strong> <span id="totalNights">0</span></p>
      <p><strong>Total Cost:</strong> $<span id="totalCost">0</span></p>
    </div>

    <button
      onclick="confirmBooking()"
      class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded w-full font-medium"
    >
      Proceed to Payment
    </button>
  </div>

  <script>
    // Load apartment and user data from localStorage
    const apartmentName = localStorage.getItem("apartmentName") || "Unknown Apartment";
    const apartmentRate = parseInt(localStorage.getItem("apartmentRate") || 0);
    const userName = localStorage.getItem("fullName") || "Guest";
    const userEmail = localStorage.getItem("email") || "N/A";

    document.getElementById("apartmentName").textContent = apartmentName;
    document.getElementById("apartmentRate").textContent = apartmentRate;
    document.getElementById("userName").textContent = userName;
    document.getElementById("userEmail").textContent = userEmail;

    const checkinInput = document.getElementById("checkin");
    const checkoutInput = document.getElementById("checkout");
    const totalNightsDisplay = document.getElementById("totalNights");
    const totalCostDisplay = document.getElementById("totalCost");

    function calculateTotal() {
      const checkin = new Date(checkinInput.value);
      const checkout = new Date(checkoutInput.value);
      if (!isNaN(checkin.getTime()) && !isNaN(checkout.getTime())) {
        const nights = Math.max(1, Math.ceil((checkout - checkin) / (1000 * 60 * 60 * 24)));
        const totalCost = nights * apartmentRate;
        totalNightsDisplay.textContent = nights;
        totalCostDisplay.textContent = totalCost;
        return { nights, totalCost, checkin, checkout };
      }
      return { nights: 0, totalCost: 0 };
    }

    checkinInput.addEventListener("change", calculateTotal);
    checkoutInput.addEventListener("change", calculateTotal);

    function confirmBooking() {
      const { totalCost, checkin, checkout } = calculateTotal();
      if (!checkinInput.value || !checkoutInput.value) {
        alert("Please select both check-in and check-out dates.");
        return;
      }

      const params = new URLSearchParams({
        amount: totalCost,
        checkin: checkinInput.value,
        checkout: checkoutInput.value,
        apartment: apartmentName,
        name: userName,
        email: userEmail,
      });

      window.location.href = "payment.html?" + params.toString();
    }
  </script>
</body>
</html>
