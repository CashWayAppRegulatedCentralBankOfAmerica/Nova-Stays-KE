<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Become a Host - Nova Stays KE</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 min-h-screen">
  <div class="max-w-4xl mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold text-center mb-6 text-blue-700">Become a Host</h1>

    <!-- Form -->
    <form id="hostForm" class="bg-white p-6 rounded-lg shadow-md space-y-4">
      <input type="text" id="hostName" placeholder="Your Name" class="w-full border rounded p-2" required>
      <input type="text" id="listingName" placeholder="Listing Name" class="w-full border rounded p-2" required>
      <input type="text" id="location" placeholder="Location" class="w-full border rounded p-2" required>
      <input type="number" id="pricePerNight" placeholder="Price per Night (KES)" class="w-full border rounded p-2" required>
      
      <label class="block font-medium">Upload Property Images (max 20)</label>
      <input type="file" id="propertyImages" accept="image/*" multiple class="w-full border rounded p-2" required>

      <label class="block font-medium">Upload Host Profile Image</label>
      <input type="file" id="hostProfile" accept="image/*" class="w-full border rounded p-2" required>

      <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">Submit Listing</button>
    </form>

    <!-- Host Panel -->
    <div class="mt-10">
      <h2 class="text-2xl font-semibold mb-4">Your Listings</h2>
      <div id="hostListings" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
    </div>
  </div>

  <script>
    const hostForm = document.getElementById('hostForm');
    const hostListings = document.getElementById('hostListings');

    function getListings() {
      return JSON.parse(localStorage.getItem('nova_listings')) || [];
    }

    function saveListings(listings) {
      localStorage.setItem('nova_listings', JSON.stringify(listings));
    }

    function renderListings() {
      const listings = getListings();
      hostListings.innerHTML = '';

      listings.forEach((listing, index) => {
        const card = document.createElement('div');
        card.className = 'bg-white rounded shadow p-4';

        card.innerHTML = `
          <img src="${listing.images[0]}" class="w-full h-40 object-cover rounded mb-2" alt="">
          <h3 class="text-lg font-bold">${listing.listingName}</h3>
          <p>Location: ${listing.location}</p>
          <p>Price: KES ${listing.pricePerNight}</p>
          <p>Host: ${listing.hostName}</p>
          <div class="flex space-x-2 mt-2">
            <button onclick="deleteListing(${index})" class="text-red-600 hover:underline">Delete</button>
          </div>
        `;
        hostListings.appendChild(card);
      });
    }

    function deleteListing(index) {
      const listings = getListings();
      listings.splice(index, 1);
      saveListings(listings);
      renderListings();
    }

    hostForm.addEventListener('submit', async (e) => {
      e.preventDefault();

      const hostName = document.getElementById('hostName').value.trim();
      const listingName = document.getElementById('listingName').value.trim();
      const location = document.getElementById('location').value.trim();
      const pricePerNight = document.getElementById('pricePerNight').value.trim();
      const imageFiles = document.getElementById('propertyImages').files;
      const hostProfileFile = document.getElementById('hostProfile').files[0];

      if (imageFiles.length === 0 || imageFiles.length > 20 || !hostProfileFile) {
        alert('Please upload between 1 and 20 images and a host profile image.');
        return;
      }

      // Convert images to base64
      const toBase64 = file => new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result);
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });

      const imageBase64s = await Promise.all([...imageFiles].map(toBase64));
      const hostProfileImage = await toBase64(hostProfileFile);

      const listing = {
        hostName,
        listingName,
        location,
        pricePerNight,
        images: imageBase64s,
        hostProfileImage
      };

      const listings = getListings();
      listings.push(listing);
      saveListings(listings);

      hostForm.reset();
      renderListings();

      alert('Listing added successfully!');
    });

    // Load existing listings on page load
    document.addEventListener('DOMContentLoaded', renderListings);
  </script>
</body>
</html>
