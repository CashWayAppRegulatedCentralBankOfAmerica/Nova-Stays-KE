<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Host Portal - Nova Stays KE</title>

  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    html, body {
      margin: 0;
      padding: 0;
      max-width: 100vw;
      overflow-x: hidden;
      background-color: #f9fafb;
    }
    .green-dot {
      display: inline-block;
      width: 10px;
      height: 10px;
      background: #22c55e; /* green-500 */
      border-radius: 50%;
      margin-left: 6px;
      vertical-align: middle;
    }
    .modal-bg {
      background: rgba(0,0,0,0.5);
    }
  </style>
</head>
<body class="font-sans text-gray-800">

  <!-- Header -->
  <header class="bg-white shadow p-4 flex justify-between items-center">
    <h1 class="text-xl font-bold text-green-600">Nova Stays KE</h1>
    <div class="text-right">
      <p id="hostName" class="font-semibold"></p>
      <p id="hostEmail" class="text-sm text-gray-600"></p>
      <p id="hostPhone" class="text-sm text-gray-600"></p>
    </div>
  </header>

  <main class="max-w-5xl mx-auto mt-8 px-4">

    <!-- Listings Section -->
    <section>
      <h2 class="text-2xl font-bold mb-4 text-green-700">Your Listings</h2>
      <div id="listingsContainer" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div>
    </section>

    <!-- Payments Section -->
    <section class="mt-12 bg-white p-6 rounded-lg shadow-md">
      <h2 class="text-2xl font-bold mb-4 text-green-700">Payment Summary</h2>

      <div class="grid grid-cols-1 md:grid-cols-4 gap-6 text-center">
        <div class="p-4 border rounded">
          <p class="text-gray-500">Monthly Payment</p>
          <p class="text-xl font-bold" id="monthlyPayment">$0.00</p>
        </div>
        <div class="p-4 border rounded">
          <p class="text-gray-500">Payment Methods</p>
          <p class="text-xl font-bold" id="paymentMethods">N/A</p>
        </div>
        <div class="p-4 border rounded">
          <p class="text-gray-500">Payouts</p>
          <p class="text-xl font-bold" id="payouts">$0.00</p>
        </div>
        <div class="p-4 border rounded">
          <p class="text-gray-500">Pending Payments</p>
          <p class="text-xl font-bold" id="pendingPayments">$0.00</p>
        </div>
      </div>
    </section>
  </main>

  <!-- Modal for edit/delete message -->
  <div id="modal" class="hidden fixed inset-0 flex items-center justify-center modal-bg z-50">
    <div class="bg-white p-6 rounded shadow max-w-sm text-center">
      <p id="modalMessage" class="mb-4"></p>
      <button id="modalClose" class="bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded">Close</button>
    </div>
  </div>

  <!-- Modal for verification code -->
  <div id="verifyModal" class="hidden fixed inset-0 flex items-center justify-center modal-bg z-50">
    <div class="bg-white p-6 rounded shadow max-w-sm text-center">
      <p class="mb-4">Enter Verification Code to verify your listing:</p>
      <input id="verifyCodeInput" type="text" class="border p-2 rounded w-full mb-4" placeholder="Verification Code" />
      <div class="flex justify-center gap-4">
        <button id="verifySubmit" class="bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded">Verify</button>
        <button id="verifyCancel" class="bg-gray-400 hover:bg-gray-500 text-white py-2 px-4 rounded">Cancel</button>
      </div>
      <p id="verifyError" class="text-red-600 mt-3 hidden">Incorrect code. Listing not yet verified.</p>
    </div>
  </div>

<script>
  const modal = document.getElementById('modal');
  const modalMessage = document.getElementById('modalMessage');
  const modalClose = document.getElementById('modalClose');

  const verifyModal = document.getElementById('verifyModal');
  const verifyCodeInput = document.getElementById('verifyCodeInput');
  const verifySubmit = document.getElementById('verifySubmit');
  const verifyCancel = document.getElementById('verifyCancel');
  const verifyError = document.getElementById('verifyError');

  let listings = [];
  let currentHostEmail = null;
  let currentHostName = null;
  let currentHostPhone = null;

  // Store listing id being verified
  let verifyingListingId = null;

  function loadHostInfo() {
    currentHostName = localStorage.getItem('currentHostName') || "Unknown Host";
    currentHostEmail = localStorage.getItem('currentHostEmail') || null;
    currentHostPhone = localStorage.getItem('currentHostPhone') || "N/A";

    document.getElementById('hostName').textContent = currentHostName;
    document.getElementById('hostEmail').textContent = currentHostEmail || "No email saved";
    document.getElementById('hostPhone').textContent = currentHostPhone;
  }

  function loadListings() {
    try {
      const stored = localStorage.getItem('novaStaysListings');
      if (!stored) return [];
      return JSON.parse(stored);
    } catch {
      return [];
    }
  }

  function saveListings(newListings) {
    localStorage.setItem('novaStaysListings', JSON.stringify(newListings));
  }

  // Show modal with message
  function showModal(message) {
    modalMessage.textContent = message;
    modal.classList.remove('hidden');
  }

  function hideModal() {
    modal.classList.add('hidden');
  }

  // Show verify modal
  function showVerifyModal(listingId) {
    verifyingListingId = listingId;
    verifyCodeInput.value = '';
    verifyError.classList.add('hidden');
    verifyModal.classList.remove('hidden');
    verifyCodeInput.focus();
  }

  function hideVerifyModal() {
    verifyModal.classList.add('hidden');
    verifyingListingId = null;
  }

  // Render listings for this host only
  function renderListings() {
    const container = document.getElementById('listingsContainer');
    container.innerHTML = '';

    if (!currentHostEmail) {
      container.innerHTML = "<p class='text-red-600'>No host email found. Please login via host.html first.</p>";
      return;
    }

    // Filter listings for this host
    const hostListings = listings.filter(l => l.hostEmail === currentHostEmail);

    if (hostListings.length === 0) {
      container.innerHTML = "<p class='text-gray-600 italic'>No listings found for your account. Please add properties via Host Portal.</p>";
      return;
    }

    hostListings.forEach(listing => {
      const card = document.createElement('div');
      card.className = "bg-white rounded-lg shadow p-4 flex flex-col";

      // Listing title + verification status
      const titleLine = document.createElement('div');
      titleLine.className = "flex items-center justify-between mb-2";

      const title = document.createElement('h3');
      title.textContent = listing.title;
      title.className = "text-lg font-semibold";

      const status = document.createElement('span');
      status.className = listing.verificationStatus === 'live' ? 'text-green-600 font-semibold' : 'text-yellow-600 font-semibold';
      status.textContent = listing.verificationStatus === 'live' ? 'Live' : 'Pending Verification';

      if (listing.verificationStatus === 'live') {
        const greenDot = document.createElement('span');
        greenDot.className = 'green-dot';
        status.appendChild(greenDot);
      }

      titleLine.appendChild(title);
      titleLine.appendChild(status);

      card.appendChild(titleLine);

      // Price and Location
      const priceLocation = document.createElement('p');
      priceLocation.textContent = `Price: $${listing.price.toFixed(2)} / night | Location: ${listing.location}`;
      priceLocation.className = "text-gray-700 mb-2";
      card.appendChild(priceLocation);

      // Main Image (first image)
      if (listing.images && listing.images.length > 0) {
        const img = document.createElement('img');
        img.src = listing.images[0];
        img.alt = listing.title;
        img.className = "w-full h-48 object-cover rounded mb-4";
        card.appendChild(img);
      }

      // Buttons container
      const btnContainer = document.createElement('div');
      btnContainer.className = "flex justify-between";

      // Edit button
      const editBtn = document.createElement('button');
      editBtn.textContent = 'Edit';
      editBtn.className = 'bg-yellow-400 hover:bg-yellow-500 text-gray-900 font-semibold py-1 px-3 rounded';
      editBtn.onclick = () => {
        if (listing.verificationStatus === 'live') {
          showModal("Editing is restricted for verified listings. Please contact support.");
        } else {
          showModal("Editing is currently disabled for pending listings. Please verify first or contact support.");
        }
      };

      // Delete button
      const deleteBtn = document.createElement('button');
      deleteBtn.textContent = 'Delete';
      deleteBtn.className = 'bg-red-500 hover:bg-red-600 text-white font-semibold py-1 px-3 rounded';
      deleteBtn.onclick = () => {
        if (listing.verificationStatus === 'live') {
          showModal("Deleting is restricted for verified listings. Please contact support.");
        } else {
          showModal("Deleting is currently disabled for pending listings. Please verify first or contact support.");
        }
      };

      // Verify button (only show if pending)
      let verifyBtn = null;
      if (listing.verificationStatus === 'pending') {
        verifyBtn = document.createElement('button');
        verifyBtn.textContent = 'Verify';
        verifyBtn.className = 'bg-green-600 hover:bg-green-700 text-white font-semibold py-1 px-3 rounded';
        verifyBtn.onclick = () => showVerifyModal(listing.id);
      }

      btnContainer.appendChild(editBtn);
      btnContainer.appendChild(deleteBtn);
      if (verifyBtn) btnContainer.appendChild(verifyBtn);

      card.appendChild(btnContainer);

      container.appendChild(card);
    });
  }

  // Handle verification submit
  verifySubmit.addEventListener('click', () => {
    const code = verifyCodeInput.value.trim();
    if (code === "1234") {
      // Mark listing as live
      const listingIndex = listings.findIndex(l => l.id === verifyingListingId);
      if (listingIndex !== -1) {
        listings[listingIndex].verificationStatus = 'live';
        saveListings(listings);
        renderListings();
        hideVerifyModal();
        alert("Listing verified and is now live!");
      }
    } else {
      verifyError.classList.remove('hidden');
    }
  });

  verifyCancel.addEventListener('click', () => {
    hideVerifyModal();
  });

  modalClose.addEventListener('click', () => {
    hideModal();
  });

  // Initialize
  function init() {
    loadHostInfo();
    listings = loadListings();
    renderListings();

    // TODO: Load real payment data or mock it here
    document.getElementById('monthlyPayment').textContent = "$150.00";
    document.getElementById('paymentMethods').textContent = "Bank Transfer, PayPal";
    document.getElementById('payouts').textContent = "$1200.00";
    document.getElementById('pendingPayments').textContent = "$300.00";
  }

  window.onload = init;
</script>
</body>
</html>
