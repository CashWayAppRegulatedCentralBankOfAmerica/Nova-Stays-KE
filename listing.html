<!DOCTYPE html>
<html lang="en" >
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Nova Stays KE - Listings</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Simple image carousel styles */
    .carousel-container {
      position: relative;
      width: 100%;
      max-width: 350px;
      overflow: hidden;
      border-radius: 0.5rem;
    }
    .carousel-images {
      display: flex;
      transition: transform 0.4s ease-in-out;
    }
    .carousel-images img {
      width: 100%;
      flex-shrink: 0;
      object-fit: cover;
      height: 220px;
    }
    .carousel-btn {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(0,0,0,0.4);
      color: white;
      padding: 0.3rem 0.6rem;
      border-radius: 9999px;
      cursor: pointer;
      user-select: none;
    }
    .carousel-btn.left {
      left: 0.5rem;
    }
    .carousel-btn.right {
      right: 0.5rem;
    }
  </style>
</head>
<body class="bg-gray-50 min-h-screen flex flex-col">

  <!-- Header -->
  <header class="bg-white shadow p-4 flex justify-between items-center">
    <h1 class="text-2xl font-bold text-green-600">Nova Stays KE</h1>
    <nav class="space-x-3">
      <button id="filterNairobi" class="px-3 py-1 rounded-md bg-green-600 text-white hover:bg-green-700">Nairobi</button>
      <button id="filterKisumu" class="px-3 py-1 rounded-md bg-green-600 text-white hover:bg-green-700">Kisumu</button>
      <button id="filterAll" class="px-3 py-1 rounded-md bg-gray-300 text-gray-700 hover:bg-gray-400">All</button>
    </nav>
    <div id="userInfo" class="text-sm text-gray-700">
      <!-- User name and email will show here -->
    </div>
  </header>

  <!-- Listings Container -->
  <main class="flex-grow max-w-6xl mx-auto p-4 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    <!-- Listings will be injected here -->
  </main>

  <script>
    // --- Utility: get user info from localStorage (simulate sign up) ---
    function getCurrentUser() {
      // Expect localStorage keys: 'signedUpName' and 'signedUpEmail' or null
      return {
        name: localStorage.getItem("signedUpName") || null,
        email: localStorage.getItem("signedUpEmail") || null
      };
    }

    // --- Render user info top-right ---
    function renderUserInfo() {
      const userDiv = document.getElementById("userInfo");
      const user = getCurrentUser();
      if (user.name && user.email) {
        userDiv.textContent = `Signed in as: ${user.name} (${user.email})`;
      } else {
        userDiv.innerHTML = `<a href="signup.html" class="text-green-600 hover:underline">Sign Up</a>`;
      }
    }

    // --- Load listings from localStorage ---
    function loadListings() {
      const listingsRaw = localStorage.getItem("novaStaysListings");
      if (!listingsRaw) return [];
      try {
        return JSON.parse(listingsRaw);
      } catch {
        return [];
      }
    }

    // --- Filter listings by location ---
    let currentFilter = null; // null means show all
    function filterListings(listings, location) {
      if (!location) return listings;
      return listings.filter(l => l.location.toLowerCase() === location.toLowerCase());
    }

    // --- Create a carousel for listing images ---
    function createCarousel(images) {
      const container = document.createElement("div");
      container.className = "carousel-container";

      const imagesWrapper = document.createElement("div");
      imagesWrapper.className = "carousel-images";

      images.forEach(src => {
        const img = document.createElement("img");
        img.src = src;
        img.alt = "Listing image";
        imagesWrapper.appendChild(img);
      });

      container.appendChild(imagesWrapper);

      // Carousel controls only if multiple images
      if (images.length > 1) {
        let currentIndex = 0;

        const btnLeft = document.createElement("button");
        btnLeft.textContent = "‹";
        btnLeft.className = "carousel-btn left";
        btnLeft.onclick = () => {
          currentIndex = (currentIndex - 1 + images.length) % images.length;
          imagesWrapper.style.transform = `translateX(-${currentIndex * 100}%)`;
        };

        const btnRight = document.createElement("button");
        btnRight.textContent = "›";
        btnRight.className = "carousel-btn right";
        btnRight.onclick = () => {
          currentIndex = (currentIndex + 1) % images.length;
          imagesWrapper.style.transform = `translateX(-${currentIndex * 100}%)`;
        };

        container.appendChild(btnLeft);
        container.appendChild(btnRight);
      }

      return container;
    }

    // --- Create a listing card ---
    function createListingCard(listing) {
      const card = document.createElement("article");
      card.className = "bg-white rounded-lg shadow-md p-4 flex flex-col";

      // Image carousel
      const carousel = createCarousel(listing.images);
      card.appendChild(carousel);

      // Title and location
      const title = document.createElement("h2");
      title.textContent = listing.title;
      title.className = "mt-3 font-semibold text-lg text-green-700";
      card.appendChild(title);

      const location = document.createElement("p");
      location.textContent = listing.location;
      location.className = "text-gray-500 text-sm";
      card.appendChild(location);

      // Price per night
      const price = document.createElement("p");
      price.textContent = `$${listing.price.toFixed(2)} / night`;
      price.className = "font-bold mt-1";
      card.appendChild(price);

      // Features
      if (listing.features && listing.features.length > 0) {
        const features = document.createElement("p");
        features.textContent = "Features: " + listing.features.join(", ");
        features.className = "text-xs mt-2 text-gray-600";
        card.appendChild(features);
      }

      // Host info (avatar + name)
      const hostDiv = document.createElement("div");
      hostDiv.className = "flex items-center mt-3 gap-2";

      const avatarImg = document.createElement("img");
      avatarImg.src = listing.hostAvatar;
      avatarImg.alt = "Host avatar";
      avatarImg.className = "w-10 h-10 rounded-full object-cover border border-green-600";

      const hostName = document.createElement("span");
      hostName.textContent = listing.hostName;
      hostName.className = "text-sm font-medium text-green-700";

      hostDiv.appendChild(avatarImg);
      hostDiv.appendChild(hostName);

      card.appendChild(hostDiv);

      // Rating with clickable reviews (fake sample reviews)
      const ratingDiv = document.createElement("div");
      ratingDiv.className = "mt-2 text-yellow-500 cursor-pointer select-none";
      ratingDiv.textContent = listing.rating || "⭐⭐⭐⭐☆";

      ratingDiv.title = "Click to see reviews";
      ratingDiv.onclick = () => {
        alert(`Reviews for ${listing.title}:\n\n- Great place!\n- Very clean and cozy.\n- Would stay again!`);
      };

      card.appendChild(ratingDiv);

      // Book Now button
      const bookBtn = document.createElement("button");
      bookBtn.textContent = "Book Now";
      bookBtn.className = "mt-4 bg-green-600 hover:bg-green-700 text-white py-2 rounded-md";
      bookBtn.onclick = () => {
        const user = getCurrentUser();
        if (!user.name || !user.email) {
          alert("Please sign up or sign in to book a property.");
          window.location.href = "signup.html";
          return;
        }
        // Pass details via query params to book.html
        const params = new URLSearchParams({
          listingId: listing.id,
          listingTitle: listing.title,
          listingLocation: listing.location,
          listingPrice: listing.price,
          bookerName: user.name,
          bookerEmail: user.email,
        });
        window.location.href = "book.html?" + params.toString();
      };

      card.appendChild(bookBtn);

      return card;
    }

    // --- Render listings with optional filter ---
    function renderListings(filterLocation = null) {
      const main = document.querySelector("main");
      main.innerHTML = "";

      const allListings = loadListings();
      const listings = filterListings(allListings, filterLocation);

      if (listings.length === 0) {
        const noResult = document.createElement("p");
        noResult.textContent = "No properties found.";
        noResult.className = "text-center text-gray-500 col-span-full";
        main.appendChild(noResult);
        return;
      }

      listings.forEach(listing => {
        main.appendChild(createListingCard(listing));
      });
    }

    // --- Setup filter buttons ---
    document.getElementById("filterNairobi").addEventListener("click", () => {
      currentFilter = "Nairobi";
      renderListings(currentFilter);
      highlightFilterBtn(currentFilter);
    });
    document.getElementById("filterKisumu").addEventListener("click", () => {
      currentFilter = "Kisumu";
      renderListings(currentFilter);
      highlightFilterBtn(currentFilter);
    });
    document.getElementById("filterAll").addEventListener("click", () => {
      currentFilter = null;
      renderListings(null);
      highlightFilterBtn(null);
    });

    // Highlight active filter button
    function highlightFilterBtn(filter) {
      ["filterNairobi", "filterKisumu", "filterAll"].forEach(id => {
        const btn = document.getElementById(id);
        if (
          (filter === "Nairobi" && id === "filterNairobi") ||
          (filter === "Kisumu" && id === "filterKisumu") ||
          (filter === null && id === "filterAll")
        ) {
          btn.classList.add("bg-green-700", "text-white");
          btn.classList.remove("bg-gray-300", "text-gray-700");
        } else {
          btn.classList.remove("bg-green-700", "text-white");
          btn.classList.add("bg-gray-300", "text-gray-700");
        }
      });
    }

    // Initial render
    renderUserInfo();
    renderListings();
    highlightFilterBtn(null);

  </script>
</body>
</html>
