<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Nova Stays KE - Listings</title>

  <!-- Bootstrap (optional) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    .carousel-btn {
      background-color: rgba(0,0,0,0.4);
      color: white;
      font-size: 14px;
      padding: 4px 10px;
      border-radius: 9999px;
    }
    html, body {
      margin: 0;
      padding: 0;
      overflow-x: hidden;
      max-width: 100vw;
    }
  </style>
</head>
<body class="bg-gray-50 text-gray-800 overflow-x-hidden w-screen max-w-full">

<!-- Header -->
<!-- Header -->
<header class="bg-white shadow p-4 flex justify-between items-start">
  <h1 class="text-xl font-bold text-green-600">Nova Stays KE</h1>
  <div class="text-sm text-gray-600 text-right leading-snug">
    <span class="font-semibold" id="userName">John Doe</span><br>
    <span id="userEmail">johndoe@example.com</span>
  </div>
</header>


<!-- Add this style block somewhere in your <head> or a CSS file -->
<style>
  .no-scrollbar::-webkit-scrollbar {
    display: none;
  }
  .no-scrollbar {
    -ms-overflow-style: none;  /* IE and Edge */
    scrollbar-width: none;  /* Firefox */
  }
</style>

<!-- Top Location Filters -->
<nav class="flex overflow-x-auto no-scrollbar gap-3 my-4 px-2">
  <a href="#" class="bg-green-100 text-green-800 px-4 py-1.5 rounded-full text-sm font-medium whitespace-nowrap">Nairobi</a>
  <a href="#" class="bg-green-100 text-green-800 px-4 py-1.5 rounded-full text-sm font-medium whitespace-nowrap">Mombasa</a>
  <a href="#" class="bg-green-100 text-green-800 px-4 py-1.5 rounded-full text-sm font-medium whitespace-nowrap">Diani</a>
  <a href="#" class="bg-green-100 text-green-800 px-4 py-1.5 rounded-full text-sm font-medium whitespace-nowrap">Malindi</a>
  <a href="#" class="bg-green-100 text-green-800 px-4 py-1.5 rounded-full text-sm font-medium whitespace-nowrap">Kisumu</a>
  <a href="#" class="bg-green-100 text-green-800 px-4 py-1.5 rounded-full text-sm font-medium whitespace-nowrap">Naivasha</a>
  <a href="#" class="bg-green-100 text-green-800 px-4 py-1.5 rounded-full text-sm font-medium whitespace-nowrap">Nakuru</a>
  <a href="#" class="bg-green-100 text-green-800 px-4 py-1.5 rounded-full text-sm font-medium whitespace-nowrap">Dar es Salaam</a>
  <a href="#" class="bg-green-100 text-green-800 px-4 py-1.5 rounded-full text-sm font-medium whitespace-nowrap">Zanzibar</a>
  <a href="#" class="bg-green-100 text-green-800 px-4 py-1.5 rounded-full text-sm font-medium whitespace-nowrap">Mikocheni</a>
  <a href="#" class="bg-green-100 text-green-800 px-4 py-1.5 rounded-full text-sm font-medium whitespace-nowrap">Ngorongoro Crater</a>
</nav>

  <!-- Listings Section -->
  <main class="max-w-6xl mx-auto px-4 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-10">

<!-- Listing 4 -->
<div class="bg-white rounded-lg shadow-sm overflow-hidden max-w-sm mx-auto">
  <!-- Main Image -->
  <img
    id="carouselThumb4"
    src="IMG-20250520-WA0028.jpg"
    class="w-full h-48 object-cover"
    alt="Listing Image"
  />

  <!-- Thumbnails -->
  <div class="flex justify-center items-center gap-2 mt-2 overflow-x-auto">
    <!-- Thumbnails for Listing 4 -->
<div class="flex justify-center items-center gap-2 mt-2 overflow-x-auto">
  <img src="IMG-20250520-WA0025.jpg" class="w-16 h-12 object-cover rounded cursor-pointer" alt="Thumb 1" onclick="document.getElementById('carouselThumb4').src=this.src" />
  <img src="IMG-20250520-WA0028.jpg" class="w-16 h-12 object-cover rounded cursor-pointer" alt="Thumb 2" onclick="document.getElementById('carouselThumb4').src=this.src" />
  <img src="IMG-20250520-WA0015.jpg" class="w-16 h-12 object-cover rounded cursor-pointer" alt="Thumb 3" onclick="document.getElementById('carouselThumb4').src=this.src" />
  <img src="IMG-20250520-WA0033.jpg" class="w-16 h-12 object-cover rounded cursor-pointer" alt="Thumb 4" onclick="document.getElementById('carouselThumb4').src=this.src" />
  <img src="IMG-20250520-WA0035.jpg" class="w-16 h-12 object-cover rounded cursor-pointer" alt="Thumb 5" onclick="document.getElementById('carouselThumb4').src=this.src" />
  <img src="IMG-20250520-WA0027.jpg" class="w-16 h-12 object-cover rounded cursor-pointer" alt="Thumb 6" onclick="document.getElementById('carouselThumb4').src=this.src" />
  <img src="IMG-20250520-WA0022.jpg" class="w-16 h-12 object-cover rounded cursor-pointer" alt="Thumb 7" onclick="document.getElementById('carouselThumb4').src=this.src" />
  <img src="IMG-20250520-WA0020.jpg" class="w-16 h-12 object-cover rounded cursor-pointer" alt="Thumb 8" onclick="document.getElementById('carouselThumb4').src=this.src" />
  <img src="IMG-20250520-WA0037.jpg" class="w-16 h-12 object-cover rounded cursor-pointer" alt="Thumb 9" onclick="document.getElementById('carouselThumb4').src=this.src" />
  <img src="IMG-20250520-WA0026.jpg" class="w-16 h-12 object-cover rounded cursor-pointer" alt="Thumb 10" onclick="document.getElementById('carouselThumb4').src=this.src" />
  <img src="IMG-20250520-WA0017.jpg" class="w-16 h-12 object-cover rounded cursor-pointer" alt="Thumb 11" onclick="document.getElementById('carouselThumb4').src=this.src" />
  <img src="IMG-20250520-WA0023.jpg" class="w-16 h-12 object-cover rounded cursor-pointer" alt="Thumb 5" onclick="document.getElementById('carouselThumb4').src=this.src" />
  <img src="IMG-20250520-WA0034.jpg" class="w-16 h-12 object-cover rounded cursor-pointer" alt="Thumb 6" onclick="document.getElementById('carouselThumb4').src=this.src" />
  <img src="IMG-20250520-WA0039.jpg" class="w-16 h-12 object-cover rounded cursor-pointer" alt="Thumb 7" onclick="document.getElementById('carouselThumb4').src=this.src" />
  <img src="IMG-20250520-WA0031.jpg" class="w-16 h-12 object-cover rounded cursor-pointer" alt="Thumb 8" onclick="document.getElementById('carouselThumb4').src=this.src" />
  <img src="IMG-20250520-WA0038.jpg" class="w-16 h-12 object-cover rounded cursor-pointer" alt="Thumb 9" onclick="document.getElementById('carouselThumb4').src=this.src" />
  <img src="IMG-20250520-WA0032.jpg" class="w-16 h-12 object-cover rounded cursor-pointer" alt="Thumb 10" onclick="document.getElementById('carouselThumb4').src=this.src" />
  <img src="IMG-20250520-WA0036.jpg" class="w-16 h-12 object-cover rounded cursor-pointer" alt="Thumb 11" onclick="document.getElementById('carouselThumb4').src=this.src" />
  <img src="IMG-20250520-WA0018.jpg" class="w-16 h-12 object-cover rounded cursor-pointer" alt="Thumb 10" onclick="document.getElementById('carouselThumb4').src=this.src" />
  <img src="IMG-20250520-WA0019.jpg" class="w-16 h-12 object-cover rounded cursor-pointer" alt="Thumb 11" onclick="document.getElementById('carouselThumb4').src=this.src" />
</div>

  </div>

  <div class="p-3">
    <div class="flex items-center justify-between mb-1">
      <div class="flex items-center gap-2">
        <!-- Host image -->
        <img
          src="IMG-20250509-WA0010.jpg"
          class="w-7 h-7 rounded-full object-cover"
          alt="Host"
        />
        <div class="text-xs">
          <p class="font-semibold">Jacob Amaitsa</p>
          <p class="text-gray-500">Kileleshwa</p>
        </div>
      </div>
      <div class="text-yellow-500 text-xs">
        ⭐⭐⭐⭐⭐ (12)
        <a href="#"
          class="text-blue-600 underline ml-2 review-trigger"
          data-listing="Fayama Homes Kileleshwa"
          data-host="Jacob Amaitsa">
          View Reviews
        </a>
      </div>
    </div>
    <h3 class="font-semibold text-sm">Fayama Homes Kileleshwa</h3>
    <p class="text-green-600 font-bold text-sm">USD 70 / night</p>
    <div class="flex flex-wrap gap-1 mt-2 text-[11px] text-gray-700">
      <span class="bg-gray-200 px-2 py-[2px] rounded-full">WiFi</span>
      <span class="bg-gray-200 px-2 py-[2px] rounded-full">Balcony</span>
      <span class="bg-gray-200 px-2 py-[2px] rounded-full">Kitchen</span>
      <span class="bg-gray-200 px-2 py-[2px] rounded-full">Pool</span>
      <span class="bg-gray-200 px-2 py-[2px] rounded-full">Laundry</span>
      <span class="bg-gray-200 px-2 py-[2px] rounded-full">Parking</span>
    </div>
    <button
      onclick="bookNow('Fayama Homes Kileleshwa', 95, 'Kileleshwa')"
      class="mt-3 w-full bg-green-600 hover:bg-green-700 text-white text-sm py-1.5 rounded-md"
    >
      Book Now
    </button>
  </div>
</div>

<!-- Listing 5 -->
<div class="bg-white rounded-lg shadow-sm overflow-hidden max-w-sm mx-auto">
  <img id="carouselThumb5" src="IMG-20250520-WA0006.jpg" class="w-full h-48 object-cover" alt="Listing Image" />
  <div class="flex justify-center items-center gap-2 mt-2 overflow-x-auto">
    <img src="IMG-20250520-WA0006.jpg" class="w-16 h-12 object-cover rounded cursor-pointer" onclick="document.getElementById('carouselThumb5').src=this.src" />
    <img src="IMG-20250520-WA0007.jpg" class="w-16 h-12 object-cover rounded cursor-pointer" onclick="document.getElementById('carouselThumb5').src=this.src" />
    <img src="IMG-20250520-WA0005.jpg" class="w-16 h-12 object-cover rounded cursor-pointer" onclick="document.getElementById('carouselThumb5').src=this.src" />
    <img src="IMG-20250520-WA0009.jpg" class="w-16 h-12 object-cover rounded cursor-pointer" onclick="document.getElementById('carouselThumb5').src=this.src" />
    <img src="IMG-20250520-WA0010.jpg" class="w-16 h-12 object-cover rounded cursor-pointer" onclick="document.getElementById('carouselThumb5').src=this.src" />
    <img src="IMG-20250520-WA0011.jpg" class="w-16 h-12 object-cover rounded cursor-pointer" onclick="document.getElementById('carouselThumb5').src=this.src" />
    <img src="IMG-20250520-WA0012.jpg" class="w-16 h-12 object-cover rounded cursor-pointer" onclick="document.getElementById('carouselThumb5').src=this.src" />
    <img src="IMG-20250520-WA0013.jpg" class="w-16 h-12 object-cover rounded cursor-pointer" onclick="document.getElementById('carouselThumb5').src=this.src" />
    <img src="IMG-20250520-WA0004.jpg" class="w-16 h-12 object-cover rounded cursor-pointer" onclick="document.getElementById('carouselThumb5').src=this.src" />
  </div>
  <div class="p-3">
    <div class="flex items-center justify-between mb-1">
      <div class="flex items-center gap-2">
        <img src="IMG-20250520-WA0014.jpg" class="w-7 h-7 rounded-full object-cover" alt="Host" />
        <div class="text-xs">
          <p class="font-semibold">Bree Joy</p>
          <p class="text-gray-500">Kilimani</p>
        </div>
      </div>
      <div class="text-yellow-500 text-xs">
        ⭐⭐⭐⭐ (30)
        <a href="#" class="text-blue-600 underline ml-2 review-trigger" data-listing="Opal Heights Kilimani" data-host="Tabitha Nelima">View Reviews</a>
      </div>
    </div>
    <h3 class="font-semibold text-sm">Opal Heights Kilimani</h3>
    <p class="text-green-600 font-bold text-sm">USD 105 / night</p>
    <div class="flex flex-wrap gap-1 mt-2 text-[11px] text-gray-700">
      <span class="bg-gray-200 px-2 py-[2px] rounded-full">Pool</span>
      <span class="bg-gray-200 px-2 py-[2px] rounded-full">Gym</span>
      <span class="bg-gray-200 px-2 py-[2px] rounded-full">Elevator</span>
    </div>
    <button onclick="bookNow('Opal Heights Kilimani', 105, 'Kilimani')" class="mt-3 w-full bg-green-600 hover:bg-green-700 text-white text-sm py-1.5 rounded-md">Book Now</button>
  </div>
</div>

  </main>

  <!-- Review Modal -->
<div id="reviewModal" class="modal hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
  <div class="bg-white rounded-lg shadow-lg p-6 max-w-sm w-full mx-4 text-center">
    <h2 class="text-lg font-bold mb-3">Review Access Restricted</h2>
    <p id="reviewModalMessage" class="text-gray-700 text-sm leading-relaxed"></p>
    <button id="closeReviewModal" class="mt-4 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded">Close</button>
  </div>
</div>

<script>
 <script>
  // Booking redirect logic
  function bookNow(name, price, location) {
    const userName = document.getElementById("userName")?.textContent || "";
    const userEmail = document.getElementById("userEmail")?.textContent || "";
    const url = `book.html?listing=${encodeURIComponent(name)}&price=${price}&location=${encodeURIComponent(location)}&user=${encodeURIComponent(userName)}&email=${encodeURIComponent(userEmail)}`;
    window.location.href = url;
  }

  // Object to store listings and image arrays + current index for carousel
  const listingsCarousel = {};
  let lastListingId = 0;

  // Update carousel image for a listing
  function updateImage(listingId) {
    const listing = listingsCarousel[listingId];
    if (!listing) return;
    const img = document.getElementById(`carouselThumb${listingId}`);
    if (img) img.src = listing.images[listing.index];
  }

  // Carousel next image
  function nextImage(listingId) {
    const listing = listingsCarousel[listingId];
    if (!listing) return;
    listing.index = (listing.index + 1) % listing.images.length;
    updateImage(listingId);
  }

  // Carousel previous image
  function prevImage(listingId) {
    const listing = listingsCarousel[listingId];
    if (!listing) return;
    listing.index = (listing.index - 1 + listing.images.length) % listing.images.length;
    updateImage(listingId);
  }

  // Review modal open & close logic
  document.addEventListener('DOMContentLoaded', () => {
    // Populate logged-in user info if available
    const user = JSON.parse(localStorage.getItem('novaLoggedIn'));
    if (user) {
      const userNameElem = document.getElementById('userName');
      const userEmailElem = document.getElementById('userEmail');
      if (userNameElem) userNameElem.textContent = user.name;
      if (userEmailElem) userEmailElem.textContent = user.email;
    }

    // Review triggers
    document.querySelectorAll('.review-trigger').forEach(button => {
      button.addEventListener('click', e => {
        e.preventDefault();
        const listing = button.dataset.listing || '';
        const host = button.dataset.host || '';
        const message = `
          Your email has not yet made any booking with <strong>${listing}</strong>.<br>
          Only users who have been hosted by <strong>${host}</strong> can leave a review within 72hrs after check-out.
        `;
        const modalMessage = document.getElementById('reviewModalMessage');
        if (modalMessage) modalMessage.innerHTML = message;
        const modal = document.getElementById('reviewModal');
        if (modal) modal.classList.remove('hidden');
      });
    });

    const closeReviewBtn = document.getElementById('closeReviewModal');
    if (closeReviewBtn) {
      closeReviewBtn.addEventListener('click', () => {
        const modal = document.getElementById('reviewModal');
        if (modal) modal.classList.add('hidden');
      });
    }
  });

  // IndexedDB open
  function openDB() {
    return new Promise((resolve, reject) => {
      const request = indexedDB.open("NovaStaysDB", 1);
      request.onerror = () => reject(request.error);
      request.onsuccess = () => resolve(request.result);
      request.onupgradeneeded = (e) => {
        const db = e.target.result;
        if (!db.objectStoreNames.contains("listings")) {
          db.createObjectStore("listings", { keyPath: "id", autoIncrement: true });
        }
      };
    });
  }

  // Get all listings from IndexedDB
  async function getAllListings() {
    const db = await openDB();
    return new Promise((resolve, reject) => {
      const tx = db.transaction("listings", "readonly");
      const store = tx.objectStore("listings");
      const request = store.getAll();
      request.onsuccess = () => resolve(request.result);
      request.onerror = () => reject(request.error);
    });
  }

  // Render all listings dynamically into container
  async function renderListings() {
    const listings = await getAllListings();
    const container = document.getElementById("listingsContainer");
    if (!container) return;

    container.innerHTML = "";

    if (listings.length === 0) {
      container.innerHTML = "<p class='text-center text-gray-600'>No listings found.</p>";
      return;
    }

    listings.forEach(listing => {
      lastListingId = Math.max(lastListingId, listing.id);

      listingsCarousel[listing.id] = {
        images: listing.images || [],
        index: 0
      };

      // Amenities badges
      const amenitiesHtml = (listing.features || []).map(am => `<span class="bg-gray-200 px-2 py-1 rounded-full text-xs">${am}</span>`).join(' ');

      // Build listing card HTML (adjust classes per your CSS)
      const cardHtml = `
        <div class="bg-white rounded-lg shadow-md overflow-hidden" id="listingCard${listing.id}">
          <div class="relative h-48 w-full overflow-hidden rounded-t-lg">
            <img id="carouselThumb${listing.id}" src="${listing.images?.[0] || 'https://via.placeholder.com/400x300?text=No+Image'}" alt="${listing.listingName || 'Listing'}" class="object-cover w-full h-full" />
            <div class="absolute top-2 right-2 flex gap-2">
              <button onclick="prevImage(${listing.id})" class="bg-white bg-opacity-70 rounded px-2 py-1 hover:bg-opacity-100">←</button>
              <button onclick="nextImage(${listing.id})" class="bg-white bg-opacity-70 rounded px-2 py-1 hover:bg-opacity-100">→</button>
            </div>
          </div>
          <div class="p-4">
            <h3 class="text-lg font-semibold">${listing.listingName || 'No Name'}</h3>
            <p class="text-gray-600">${listing.location || 'No Location'}</p>
            <p class="font-bold text-green-600 mt-1">KES ${listing.pricePerNight || 'N/A'} / night</p>
            <p class="mt-2 text-sm text-gray-700">Hosted by: ${listing.hostName || 'Unknown'}</p>
            <div class="flex flex-wrap gap-1 mt-2">${amenitiesHtml}</div>
            <button onclick="bookNow('${listing.listingName || ''}', ${listing.pricePerNight || 0}, '${listing.location || ''}')" class="mt-3 w-full bg-green-600 hover:bg-green-700 text-white text-sm py-2 rounded-md">Book Now</button>
          </div>
        </div>
      `;
      container.insertAdjacentHTML("beforeend", cardHtml);
    });
  }

  // Listen for new listings broadcast and re-render
  const channel = new BroadcastChannel('nova-listings');
  channel.onmessage = (event) => {
    if (event.data === 'new-listing-added') {
      console.log("New listing added — refreshing...");
      renderListings();
    }
  };

  // Run initial render on DOM ready
  document.addEventListener("DOMContentLoaded", renderListings);
</script>

 <!-- Footer -->
  <footer class="bg-white border-t mt-12">
    <footer class="fixed bottom-0 left-0 w-full bg-white text-center py-4 text-gray-500 text-sm z-50 shadow">
      <p>&copy; 2025 Nova Prime. All rights reserved.</p>
      <div class="space-x-4">
        <a href="privacy.html" class="hover:text-green-600">Privacy</a>
        <a href="terms.html" class="hover:text-green-600">Terms</a>
        <a href="host.html" class="hover:text-green-600">Help</a>
      </div>
    </div>
  </footer>
    
</body>
</html>
